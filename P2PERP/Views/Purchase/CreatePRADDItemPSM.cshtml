@{
    ViewBag.Title = "Item Request Status with Items";
}

<div class="container mt-4">
    <div class="card shadow-lg border-0 rounded-4 p-4">
        <h4 class="mb-4">Item Request Management</h4>

        <!-- Dropdown -->
        <div class="row mb-3">
            <div class="col-md-3">
                <label class="form-label fw-bold">Item Request:</label>
                <select id="ItemReqStatus" class="form-select"></select>
            </div>
        </div>

        <!-- Table -->
        <div class="table-responsive">
            <table id="itemsTable" class="table table-bordered table-striped w-100">
                <thead class="table-dark">
                    <tr>
                        <th>Item Code</th>
                        <th>Item Name</th>
                        <th>Description</th>
                        <th>UOM</th>
                        <th>Unit Rate</th>
                        <th>Quantity</th>
                        <th>Required Date</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

 <script>
        let table;

        $(document).ready(function () {
            // Initialize DataTable
            table = $('#itemsTable').DataTable({
                columns: [
                    { data: "ItemCode" },
                    { data: "ItemName" },
                    { data: "Description" },
                    { data: "UOMName" },
                    { data: "UnitRates" },
                    { data: "Quantity" },
                    { data: "RequiredDate" }
                ]
            });

            // Load dropdown
            $.getJSON('/Purchase/SelectItemReqStatusPSM', function (data) {
                let $ddl = $('#ItemReqStatus');
                $ddl.empty().append('<option value="">-- Select Status --</option>');
                $.each(data, function (i, item) {
                    $ddl.append($('<option>', {
                        value: item.Value,
                        text: item.Text
                    }));
                });
            });

            // On change
            $('#ItemReqStatus').change(function () {
                let selected = $(this).val();
                if (selected === "13") {
                    loadItems('/Purchase/MRPItemsListPSM');
                } else if (selected === "8") {
                    loadItems('/Purchase/GenerateStockRequirementPR');
                } else {
                    table.clear().draw();
                }
            });
        });

        function loadItems(url) {
            $.getJSON(url, function (data) {
                table.clear().rows.add(data).draw();
            });
        }
    </script>

