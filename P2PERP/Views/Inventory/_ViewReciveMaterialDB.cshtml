@model P2PLibray.Inventory.GRNdetailsDRB

<div class="modal fade" id="grnModal" tabindex="-1" aria-labelledby="grnModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content shadow-lg rounded-3">

            <!-- Header -->
            <div class="modal-header bg-primary text-white d-flex justify-content-center align-items-center rounded-top-4 position-relative">
                <h5 class="modal-title fw-bold text-white mb-0">GRN Details</h5>
                <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal"></button>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <form id="grnForm">
                    <!-- GRN Info Table -->
                    <div class="table-responsive mb-3">
                        <table class="table table-bordered align-middle">
                            <tbody class="table-secondary">
                                <tr>
                                    <th>GRNNo</th>
                                    <td><input type="text" value="@Model.GRNCode" class="form-control text-light" readonly /></td>
                                    <th>GRNDate</th>
                                    <td><input type="text" value="@Model.GRNDate.ToString("dd/MM/yyyy")" class="form-control text-light" readonly /></td>
                                </tr>
                                <tr>
                                    <th>POReference Name</th>
                                    <td><input type="text" value="@Model.POReference" class="form-control text-light" readonly /></td>
                                    <th>POContactInfo</th>
                                    <td><input type="text" value="@Model.ContactNo" class="form-control text-light" readonly /></td>
                                </tr>
                                <tr>
                                    <th>Invoice No</th>
                                    <td><input type="text" value="@Model.InvoiceCode" class="form-control text-light" readonly /></td>
                                    <th>Invoice Date</th>
                                    <td><input type="text" value="@Model.InvoiceDate" class="form-control text-light" readonly /></td>
                                </tr>
                                <tr>
                                    <th>Vendor Code</th>
                                    <td><input type="text" value="@Model.VendorCode" class="form-control text-light" readonly /></td>
                                    <th>Vendor Name</th>
                                    <td><input type="text" value="@Model.VendorName" class="form-control text-light" readonly /></td>
                                </tr>
                                <tr>
                                    <th>StorId</th>
                                    <td><input type="text" value="@Model.WareHouseCode" class="form-control text-light" readonly /></td>
                                    <th>WareHouse Name</th>
                                    <td><input type="text" value="@Model.WarehouseName" class="form-control text-light" readonly /></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- GRN Items Table -->
                    <div class="table-responsive">
                        <table class=" ItemsTable table table-bordered text-center align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th>Sr No</th>
                                    <th>Item Code</th>
                                    <th>Item Name</th>
                                    <th>Item Description</th>
                                    <th>UOM</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.Items)
                                {
                                    <tr>
                                        <td></td> <!-- Sr No will be auto-generated by DataTable -->
                                        <td>@item.ItemCode</td>
                                        <td>@item.ItemName</td>
                                        <td>@item.Description</td>
                                        <td>@item.UOMName</td>
                                        <td>@item.Quantity</td>
                                        <td>₹@item.Price</td>

                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

<!-- DataTable Script -->
<script>
    var table; // Make it global to handle reinitialization

    function initializeItemsTable() {
        // Destroy previous instance if exists
        if ($.fn.DataTable.isDataTable('.ItemsTable')) {
            table.destroy();
        }

        table = $('.ItemsTable').DataTable({
            destroy: true,
            paging: true,
            searching: true,
            ordering: true,
            info: true,
            lengthChange: false,
            pageLength: 10,
            responsive: true,
            dom: '<"d-flex justify-content-end align-items-center mb-2"f>rt<"d-flex justify-content-between align-items-center"i p>',
            columnDefs: [
                { targets: "_all", className: "text-center align-middle" },
                { targets: 0, orderable: false, searchable: false }, // Sr No
            ],
            language: {
                emptyTable: "No items available"
            }
        });

        // Dynamic Sr No for search/sort
        table.on('order.dt search.dt', function () {
            table.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                cell.innerHTML = i + 1;
            });
        }).draw();
    }

    $(document).ready(function () {
        initializeItemsTable();
    });
</script>

